{"ast":null,"code":"import { ethers } from 'ethers';\nconst provider = new ethers.providers.Web3Provider(window.ethereum);\nawait provider.send(\"eth_requestAccounts\", []);\nconst signer = provider.getSigner();\nconst abi = [\"event AccountCreated(address owner, uint256 indexed accountId, uint256 timestamp)\", \"event Deposit(address indexed user, uint256 value, uint256 timestamp)\", \"event GameCreated(uint256 gameId, uint256 betAmount, address player1, address player2, uint256 timestamp)\", \"event GameResult(uint256 gameId, address winner, uint256 timestamp)\", \"function accountGames(uint256, uint256) view returns (uint256 gameId, address player1, address player2, uint256 betAmount, address winner, uint256 timestamp)\", \"function accounts(uint256) view returns (address owner, uint256 balance)\", \"function approveBet(uint256 accountId, uint256 amount)\", \"function bet(uint256 accountId, uint256 amount)\", \"function createAccount(address newOwner)\", \"function deposit(uint256 accountId) payable\", \"function getAccounts() view returns ((address owner, uint256 balance)[])\", \"function getBalance(uint256 accountId) view returns (uint256)\", \"function getPreviousGames(uint256 accountId) view returns ((uint256 gameId, address player1, address player2, uint256 betAmount, address winner, uint256 timestamp)[])\"];\n\n// Contract address\nconst address = \"0x5fbdb2315678afecb367f032d93f642f64180aa3\";\n\n// Store the contract instance once gained access to MetaMask from client\nlet contract = null;\nexport async function createAccount(owner) {\n  await getAccess();\n  const ownersInput = document.getElementById(\"owners\");\n  const owners = ownersInput.value.split(\",\").filter(n => n);\n  if (contract) {\n    await contract.createAccount(owners).then(() => alert(\"Success\"));\n  }\n}\nexport async function getAccounts() {\n  await getAccess();\n  console.log(\"Getting accounts\");\n  if (contract) {\n    const result = await contract.getAccounts();\n    const accountsElement = document.getElementById(\"accounts\");\n    if (accountsElement) {\n      accountsElement.innerHTML = JSON.stringify(result);\n    }\n  }\n}\nasync function getAccess() {\n  if (contract) return; // If already initialized, skip\n\n  // Check if window.ethereum is available\n  if (typeof window.ethereum !== 'undefined') {\n    try {\n      // Create a new Web3 provider\n      const tempProvider = new ethers.providers.Web3Provider(window.ethereum);\n\n      // Request account access\n      await tempProvider.send(\"eth_requestAccounts\", []);\n\n      // After access is granted, get the signer\n      const tempSigner = tempProvider.getSigner();\n\n      // Initialize the contract with the signer\n      contract = new ethers.Contract(address, abi, tempSigner);\n      console.log(\"Contract initialized:\", contract);\n    } catch (error) {\n      console.error(\"Error accessing Ethereum accounts:\", error);\n    }\n  } else {\n    console.error(\"Ethereum provider (e.g., MetaMask) not found.\");\n  }\n}","map":{"version":3,"names":["ethers","provider","providers","Web3Provider","window","ethereum","send","signer","getSigner","abi","address","contract","createAccount","owner","getAccess","ownersInput","document","getElementById","owners","value","split","filter","n","then","alert","getAccounts","console","log","result","accountsElement","innerHTML","JSON","stringify","tempProvider","tempSigner","Contract","error"],"sources":["/Users/harrisb/Desktop/BetChess/frontend/src/ethersService.ts"],"sourcesContent":["import { ethers } from 'ethers';\n\ndeclare global {\n  interface Window { ethereum: any; }\n}\n\nconst provider = new ethers.providers.Web3Provider(window.ethereum);\nawait provider.send(\"eth_requestAccounts\", []);\nconst signer = provider.getSigner();\n\nconst abi = [\n  \"event AccountCreated(address owner, uint256 indexed accountId, uint256 timestamp)\",\n  \"event Deposit(address indexed user, uint256 value, uint256 timestamp)\",\n  \"event GameCreated(uint256 gameId, uint256 betAmount, address player1, address player2, uint256 timestamp)\",\n  \"event GameResult(uint256 gameId, address winner, uint256 timestamp)\",\n  \"function accountGames(uint256, uint256) view returns (uint256 gameId, address player1, address player2, uint256 betAmount, address winner, uint256 timestamp)\",\n  \"function accounts(uint256) view returns (address owner, uint256 balance)\",\n  \"function approveBet(uint256 accountId, uint256 amount)\",\n  \"function bet(uint256 accountId, uint256 amount)\",\n  \"function createAccount(address newOwner)\",\n  \"function deposit(uint256 accountId) payable\",\n  \"function getAccounts() view returns ((address owner, uint256 balance)[])\",\n  \"function getBalance(uint256 accountId) view returns (uint256)\",\n  \"function getPreviousGames(uint256 accountId) view returns ((uint256 gameId, address player1, address player2, uint256 betAmount, address winner, uint256 timestamp)[])\"\n];\n\n// Contract address\nconst address: string = \"0x5fbdb2315678afecb367f032d93f642f64180aa3\";\n\n// Store the contract instance once gained access to MetaMask from client\nlet contract: ethers.Contract | null = null;\n\nexport async function createAccount(owner: string): Promise<void> {\n  await getAccess();\n  const ownersInput = document.getElementById(\"owners\") as HTMLInputElement;\n  const owners = ownersInput.value.split(\",\").filter(n => n);\n  if (contract) {\n    await contract.createAccount(owners).then(() => alert(\"Success\"));\n  }\n}\n\nexport async function getAccounts(): Promise<void> {\n  await getAccess();\n  console.log(\"Getting accounts\");\n  if (contract) {\n    const result = await contract.getAccounts();\n    const accountsElement = document.getElementById(\"accounts\");\n    if (accountsElement) {\n      accountsElement.innerHTML = JSON.stringify(result);\n    }\n  }\n}\n\nasync function getAccess(): Promise<void> {\n  if (contract) return; // If already initialized, skip\n\n  // Check if window.ethereum is available\n  if (typeof window.ethereum !== 'undefined') {\n    try {\n      // Create a new Web3 provider\n      const tempProvider = new ethers.providers.Web3Provider(window.ethereum);\n\n      // Request account access\n      await tempProvider.send(\"eth_requestAccounts\", []);\n\n      // After access is granted, get the signer\n      const tempSigner = tempProvider.getSigner();\n\n      // Initialize the contract with the signer\n      contract = new ethers.Contract(address, abi, tempSigner);\n      console.log(\"Contract initialized:\", contract);\n    } catch (error) {\n      console.error(\"Error accessing Ethereum accounts:\", error);\n    }\n  } else {\n    console.error(\"Ethereum provider (e.g., MetaMask) not found.\");\n  }\n}\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,QAAQ;AAM/B,MAAMC,QAAQ,GAAG,IAAID,MAAM,CAACE,SAAS,CAACC,YAAY,CAACC,MAAM,CAACC,QAAQ,CAAC;AACnE,MAAMJ,QAAQ,CAACK,IAAI,CAAC,qBAAqB,EAAE,EAAE,CAAC;AAC9C,MAAMC,MAAM,GAAGN,QAAQ,CAACO,SAAS,CAAC,CAAC;AAEnC,MAAMC,GAAG,GAAG,CACV,mFAAmF,EACnF,uEAAuE,EACvE,2GAA2G,EAC3G,qEAAqE,EACrE,+JAA+J,EAC/J,0EAA0E,EAC1E,wDAAwD,EACxD,iDAAiD,EACjD,0CAA0C,EAC1C,6CAA6C,EAC7C,0EAA0E,EAC1E,+DAA+D,EAC/D,wKAAwK,CACzK;;AAED;AACA,MAAMC,OAAe,GAAG,4CAA4C;;AAEpE;AACA,IAAIC,QAAgC,GAAG,IAAI;AAE3C,OAAO,eAAeC,aAAaA,CAACC,KAAa,EAAiB;EAChE,MAAMC,SAAS,CAAC,CAAC;EACjB,MAAMC,WAAW,GAAGC,QAAQ,CAACC,cAAc,CAAC,QAAQ,CAAqB;EACzE,MAAMC,MAAM,GAAGH,WAAW,CAACI,KAAK,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAAC;EAC1D,IAAIX,QAAQ,EAAE;IACZ,MAAMA,QAAQ,CAACC,aAAa,CAACM,MAAM,CAAC,CAACK,IAAI,CAAC,MAAMC,KAAK,CAAC,SAAS,CAAC,CAAC;EACnE;AACF;AAEA,OAAO,eAAeC,WAAWA,CAAA,EAAkB;EACjD,MAAMX,SAAS,CAAC,CAAC;EACjBY,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;EAC/B,IAAIhB,QAAQ,EAAE;IACZ,MAAMiB,MAAM,GAAG,MAAMjB,QAAQ,CAACc,WAAW,CAAC,CAAC;IAC3C,MAAMI,eAAe,GAAGb,QAAQ,CAACC,cAAc,CAAC,UAAU,CAAC;IAC3D,IAAIY,eAAe,EAAE;MACnBA,eAAe,CAACC,SAAS,GAAGC,IAAI,CAACC,SAAS,CAACJ,MAAM,CAAC;IACpD;EACF;AACF;AAEA,eAAed,SAASA,CAAA,EAAkB;EACxC,IAAIH,QAAQ,EAAE,OAAO,CAAC;;EAEtB;EACA,IAAI,OAAOP,MAAM,CAACC,QAAQ,KAAK,WAAW,EAAE;IAC1C,IAAI;MACF;MACA,MAAM4B,YAAY,GAAG,IAAIjC,MAAM,CAACE,SAAS,CAACC,YAAY,CAACC,MAAM,CAACC,QAAQ,CAAC;;MAEvE;MACA,MAAM4B,YAAY,CAAC3B,IAAI,CAAC,qBAAqB,EAAE,EAAE,CAAC;;MAElD;MACA,MAAM4B,UAAU,GAAGD,YAAY,CAACzB,SAAS,CAAC,CAAC;;MAE3C;MACAG,QAAQ,GAAG,IAAIX,MAAM,CAACmC,QAAQ,CAACzB,OAAO,EAAED,GAAG,EAAEyB,UAAU,CAAC;MACxDR,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEhB,QAAQ,CAAC;IAChD,CAAC,CAAC,OAAOyB,KAAK,EAAE;MACdV,OAAO,CAACU,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC5D;EACF,CAAC,MAAM;IACLV,OAAO,CAACU,KAAK,CAAC,+CAA+C,CAAC;EAChE;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}